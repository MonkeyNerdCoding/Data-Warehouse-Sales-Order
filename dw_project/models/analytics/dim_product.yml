version: 2

models:
  - name: dim_product
    description: "Dimension table for product details"
    tests:
      - dbt_utils.equal_rowcount:
          compare_model: "`vit-lam-data.wide_world_importers.warehouse__stock_items`"
          error_if: "<>2"
          warn_if: "<>2"
  
    columns:
      - name: stock_item_key
        description: "Primary key for stock item"
        tests:
          - not_null
          - unique


      - name: stock_item_name
        description: "Name of the stock item"
        tests:
          - not_null

      - name: supplier_key
        description: "Foreign key to supplier"
        tests:
          - not_null
          - relationships:
              to: ref('stg_supplier')
              field: supplier_key

      - name: unit_package_key
        description: "Foreign key to unit package type"
        tests:
          - not_null
          - relationships:
              to: ref('dim_package_type')
              field: package_type_key

      - name: outer_package_key
        description: "Foreign key to outer package type"
        tests:
          - not_null
          - relationships:
              to: ref('dim_package_type')
              field: package_type_key

      - name: color_key
        description: "Foreign key to color"
        tests:
          - not_null
          - relationships:
              to: ref('stg_color')
              field: color_key

      - name: lead_time_days
        description: "Lead time in days"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -1

      - name: quantity
        description: "Quantity per outer package"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -1

      - name: unit_price
        description: "Unit price of product"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -1


      - name: tax_rate
        description: "Tax rate for the product"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -1
              # max_value: 15

      - name: brand
        description: "Brand of the product"
        tests:
          - not_null

      - name: size
        description: "Size description"
        tests:
          - not_null

      - name: recommended_retail_price
        description: "Recommended retail price"
        tests:
          - not_null
          - dbt_utils.accepted_range:
              min_value: -1

      - name: barcode
        description: "Barcode identifier"
        tests:
          - not_null

      - name: is_chiller_stock
        description: "Chiller stock classification"
        tests:
          - not_null
          - accepted_values:
              values: ['Chiller Stock', 'Non-Chiller Stock', 'Undefined', 'ERROR']


      - name: supplier_name
        description: "Name of supplier"
        tests:
          - not_null

      - name: supplier_category_key
        description: "Foreign key to supplier category"
        tests:
          - not_null

      - name: supplier_category_name
        description: "Name of supplier category"
        tests:
          - not_null

      - name: unit_package_name
        description: "Unit package name"
        tests:
          - not_null

      - name: outer_package_name
        description: "Outer package name"
        tests:
          - not_null

      - name: color_name
        description: "Color name"
        tests:
          - not_null


